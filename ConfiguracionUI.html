<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <title>SPARRING Attach GMAIL v0.4 - Configuración</title>
    
    <!-- Estilos CSS para una interfaz moderna -->
    <style>
      body {
        font-family: 'Google Sans', Arial, sans-serif;
        margin: 0;
        padding: 20px;
        color: #333;
        background-color: #f5f5f5;
        line-height: 1.5;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      }
      
      /* Estilos para la sección de tipos de archivo */
      .file-types-container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      
      .file-types-column {
        flex: 1 1 300px;
      }
      
      .file-types-column h4 {
        margin-top: 0;
        color: #1a73e8;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
      }
      
      .file-type-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .file-type-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px;
        border-radius: 8px;
        background-color: #e8f0fe;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px solid transparent;
        text-align: center;
      }
      
      .file-type-item:hover {
        background-color: #d2e3fc;
      }
      
      .file-type-item.selected {
        border-color: #1a73e8;
        background-color: #d2e3fc;
      }
      
      .file-type-item.exclude {
        background-color: #feecec;
      }
      
      .file-type-item.exclude:hover {
        background-color: #fdd9d9;
      }
      
      .file-type-item.exclude.selected {
        border-color: #d93025;
        background-color: #fdd9d9;
      }
      
      .file-type-item i {
        font-size: 24px;
        margin-bottom: 5px;
        color: #1a73e8;
      }
      
      .file-type-item.exclude i {
        color: #d93025;
      }
      
      .file-type-item span {
        font-size: 12px;
      }
      
      /* Estilos para Danger Zone */
      .danger-zone {
        border: 1px solid #e0e0e0;
        margin-top: 30px;
        position: relative;
        background-color: #fbfbfb;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      
      .danger-zone .section-title {
        color: #555;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f7f7f7;
        border-bottom: 1px solid #e0e0e0;
        padding: 12px 0;
        letter-spacing: 0.5px;
      }
      
      .danger-icon {
        margin: 0 8px;
        color: #f5a623;
        transition: all 0.3s ease;
      }
      
      .danger-zone:hover .danger-icon {
        transform: translateY(-1px);
      }
      
      .warning-text {
        color: #555;
        font-weight: normal;
        text-align: center;
        margin: 15px auto 25px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-left: 3px solid #f5a623;
        border-radius: 6px;
        max-width: 90%;
        background-color: #fff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      
      .danger-actions {
        display: flex;
        gap: 15px;
        flex-direction: column;
        padding: 0 10px;
        margin-bottom: 15px;
      }
      
      .danger-action {
        background-color: #ffffff;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 0;
        border: 1px solid #e0e0e0;
        border-left: 3px solid #f5a623;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }
      
      .danger-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      }
      
      .danger-action h4 {
        margin-top: 0;
        color: #555;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        font-weight: 500;
      }
      
      .danger-action h4 i {
        color: #f5a623;
      }
      
      .danger-button {
        background-color: #fff;
        color: #555;
        border: 1px solid #e0e0e0;
        padding: 12px 20px;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s;
        font-weight: 500;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }
      
      .danger-button:hover {
        background-color: #f8f8f8;
        transform: translateY(-2px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        border-color: #ddd;
      }
      
      .danger-button:active {
        transform: translateY(0);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      
      .danger-button i {
        color: #f5a623;
      }
      
      .danger-button::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.03);
        transform: scale(0);
        transition: transform 0.5s;
        border-radius: 50%;
      }
      
      .danger-button:hover::after {
        transform: scale(2);
        opacity: 0;
      }
      
      /* Estilos para checkboxes y radio buttons */
      .checkbox-label, .radio-label {
        display: flex;
        align-items: center;
        font-weight: normal;
        margin-bottom: 5px;
      }
      
      .checkbox-label input, .radio-label input {
        margin-right: 8px;
      }
      
      .container {
        max-width: 850px;
        margin: 0 auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 25px;
        position: relative;
      }
      
      .github-corner {
        position: absolute;
        top: 0;
        right: 0;
        color: #1a73e8;
        text-decoration: none;
        display: flex;
        align-items: center;
        padding: 10px;
        font-size: 14px;
        transition: all 0.3s;
      }
      
      .github-corner:hover {
        color: #0d62d6;
      }
      
      .github-corner i {
        margin-right: 5px;
        font-size: 20px;
      }
      
      footer {
        text-align: center;
        margin-top: 30px;
        padding: 15px;
        font-size: 14px;
        color: #5f6368;
        border-top: 1px solid #eee;
      }
      
      footer a {
        color: #1a73e8;
        text-decoration: none;
        transition: color 0.3s;
      }
      
      footer a:hover {
        color: #0d62d6;
        text-decoration: underline;
      }
      
      h1 {
        color: #1a73e8;
        text-align: center;
        margin-top: 0;
        padding-bottom: 10px;
        font-weight: 600;
        font-size: 28px;
        letter-spacing: -0.5px;
      }
      
      .section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        padding: 15px;
        border-bottom: 1px solid #eee;
        transition: all 0.3s ease;
        border-radius: 8px;
        background-color: #fafafa;
      }
      
      .section-title {
        font-size: 18px;
        font-weight: 500;
        margin-bottom: 15px;
        color: #1a73e8;
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 5px 0;
        border-radius: 4px;
      }
      
      .section-title::before {
        content: '▼';
        margin-right: 8px;
        font-size: 12px;
        transition: transform 0.3s ease;
      }
      
      .section.collapsed .section-title::before {
        transform: rotate(-90deg);
      }
      
      .section-content {
        overflow: hidden;
        transition: max-height 0.3s ease;
        max-height: 1000px;
      }
      
      .section.collapsed .section-content {
        max-height: 0;
      }
      
      .form-group {
        margin-bottom: 18px;
        max-width: 600px;
      }
      
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
      }
      
      input[type="text"], 
      input[type="number"] {
        width: 80%;
        max-width: 450px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.3s;
      }
      
      input[type="text"]:focus, 
      input[type="number"]:focus {
        border-color: #1a73e8;
        outline: none;
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
      }
      
      .help-text {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
      }
      
      .actions {
        display: flex;
        justify-content: space-between;
        padding-top: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }
      
      .button-group {
        display: flex;
        gap: 20px;
      }
      
      button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      button i {
        margin-right: 8px;
      }
      
      .btn-primary {
        background-color: #1a73e8;
        color: white;
      }
      
      .btn-primary:hover {
        background-color: #0d62d6;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }
      
      button + button {
        margin-left: 15px;
      }
      
      .btn-secondary {
        background-color: #f8f9fa;
        color: #3c4043;
        border: 1px solid #dadce0;
      }
      
      .btn-secondary:hover {
        background-color: #e8eaed;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .btn-danger {
        background-color: #ea4335;
        color: white;
      }
      
      .btn-danger:hover {
        background-color: #d33426;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }
      
      .status {
        margin: 15px 0;
        padding: 12px;
        border-radius: 4px;
        display: none;
        animation: fadeIn 0.3s ease;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .status.success {
        background-color: #e6f4ea;
        color: #137333;
        display: flex;
        align-items: center;
        border-left: 4px solid #34a853;
      }
      
      .status.error {
        background-color: #fce8e6;
        color: #c5221f;
        display: flex;
        align-items: center;
        border-left: 4px solid #ea4335;
      }
      
      .status:before {
        content: '';
        margin-right: 10px;
        font-weight: bold;
      }
      
      .status.success:before {
        content: '✓';
      }
      
      .status.error:before {
        content: '⚠';
      }
      
      .footer {
        text-align: center;
        margin-top: 30px;
        font-size: 12px;
        color: #666;
        padding: 15px;
        border-top: 1px solid #eee;
        background-color: #f9f9f9;
        border-radius: 0 0 8px 8px;
      }
      
      .subtitle {
        text-align: center;
        color: #5f6368;
        margin-top: -15px;
        margin-bottom: 20px;
      }
      
      .logo {
        text-align: center;
        margin-bottom: 10px;
      }
      
      .logo span {
        color: #1a73e8;
        font-weight: bold;
      }
      
      .info-panel {
        background-color: #f8fbff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border: 1px solid #e8eef7;
      }
      
      .info-panel h3 {
        color: #1a73e8;
        margin-top: 0;
      }
      
      .info-panel h4 {
        color: #5f6368;
        margin-bottom: 8px;
      }
      
      .info-panel ul, .info-panel ol {
        padding-left: 25px;
      }
      
      .info-panel li {
        margin-bottom: 8px;
      }
      
      #ayuda-content p {
        background-color: #f8fbff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #e8eef7;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      }
      
      #ayuda-content em {
        color: #5f6368;
        font-style: italic;
      }
      
      a {
        color: #1a73e8;
        text-decoration: none;
      }
      
      a:hover {
        text-decoration: underline;
      }
      
      /* Loader/Spinner */
      .loader-container {
        display: none; /* Inicialmente oculto */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #1a73e8;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Tabs para información adicional */
      .tabs {
        display: flex;
        margin-top: 30px;
        border-bottom: 1px solid #ddd;
      }
      
      .tab {
        padding: 10px 20px;
        background-color: #f0f0f0;
        border-radius: 4px 4px 0 0;
        cursor: pointer;
        margin-right: 5px;
        transition: all 0.3s;
        font-size: 14px;
        color: #5f6368;
        border: 1px solid #ddd;
        border-bottom: none;
        position: relative;
        top: 1px;
        font-weight: 500;
      }
      
      .tab:hover {
        background-color: #e0e0e0;
      }
      
      .tab.active {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-bottom: 1px solid #ffffff;
        margin-bottom: -1px;
        color: #1a73e8;
      }
      
      .tab-content {
        display: none;
        margin-top: 0;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 0 4px 4px 4px;
        border: 1px solid #ddd;
        border-top: none;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }
      
      .tab-content.active {
        display: block;
      }
      
      /* Estilos responsivos */
      @media (max-width: 600px) {
        .actions {
          flex-direction: column;
        }
        
        .actions div {
          width: 100%;
          margin-bottom: 10px;
        }
        
        button {
          width: 100%;
        }
      }
      
      /* Estilos para sección de automatización */
      .time-picker {
        display: flex;
        align-items: center;
      }
      
      .time-select {
        width: 80px;
      }
      
      .time-separator {
        margin: 0 5px;
        font-weight: 500;
      }
      
      .input-with-unit {
        display: flex;
        align-items: center;
      }
      
      .input-with-unit input {
        width: 80px;
        margin-right: 10px;
      }
      
      .input-with-unit .unit {
        color: #555;
      }
      
      .info-box {
        display: flex;
        background-color: #e8f0fe;
        border-radius: 6px;
        padding: 15px;
        margin-top: 15px;
        border-left: 3px solid #1a73e8;
      }
      
      .info-icon {
        margin-right: 10px;
        color: #1a73e8;
      }
      
      /* Estilos para las tarjetas de frecuencia */
      .freq-label {
        display: block;
        margin-bottom: 12px;
        font-weight: 500;
      }
      
      .frequency-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 20px;
      }
      
      .frequency-card {
        position: relative;
        width: calc(50% - 8px);
        min-width: 200px;
        max-width: 300px;
      }
      
      .freq-radio {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }
      
      .freq-card-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 15px;
        background-color: #f8f9fa;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .freq-radio:checked + .freq-card-label {
        border-color: #1a73e8;
        background-color: #e8f0fe;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      
      .freq-icon {
        font-size: 32px;
        margin-bottom: 10px;
        color: #5f6368;
      }
      
      .freq-radio:checked + .freq-card-label .freq-icon {
        color: #1a73e8;
      }
      
      .freq-title {
        font-weight: 500;
        font-size: 16px;
        margin-bottom: 5px;
      }
      
      .freq-desc {
        font-size: 13px;
        color: #5f6368;
        text-align: center;
      }
      
      /* Estilos responsivos para tarjetas */
      @media (max-width: 768px) {
        .frequency-card {
          width: 100%;
          max-width: none;
        }
      }
      
      .status-message {
        margin-top: 10px;
        padding: 12px;
        border-radius: 6px;
        display: none;
      }
      
      .status-message.success {
        background-color: #e6f4ea;
        color: #137333;
        border-left: 3px solid #34a853;
        display: block;
      }
      
      .status-message.error {
        background-color: #fce8e6;
        color: #c5221f;
        border-left: 3px solid #ea4335;
        display: block;
      }
    </style>
    <!-- Material Icons - Google Font Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  </head>
  
  <body>
    <!-- Loader/Spinner para procesos -->
    <div class="loader-container" id="loader">
      <div class="loader"></div>
    </div>
    
    <div class="container">
      <div class="header-links" style="position: absolute; top: 15px; right: 15px; display: flex; gap: 15px;">
        <a href="#aviso-legal" style="display: flex; align-items: center; color: #f5a623; text-decoration: none; font-size: 14px; font-weight: 500;">
          <i class="material-icons" style="margin-right: 4px; font-size: 18px;">gavel</i> Aviso Legal
        </a>
        <a href="https://github.com/SparringLabs/attach-gmail-google-script" target="_blank" style="display: flex; align-items: center; color: #1a73e8; text-decoration: none; font-size: 14px; font-weight: 500;">
          <i class="material-icons" style="margin-right: 4px; font-size: 18px;">code</i> Ver en GitHub
        </a>
      </div>
      <div class="logo"><span>SPARRING</span> Attach GMAIL</div>
      <h1>Configuración SPARRING</h1>
      <p class="subtitle">Herramienta de sincronización inteligente para adjuntos de correo</p>
      
      <div id="status" class="status"></div>
      
      <div class="section">
        <div class="section-title">Configuración de Carpetas</div>
        <div class="section-content">
        
        <div class="form-group">
          <label for="mainFolder">Nombre de Carpeta Principal:</label>
          <input type="text" id="mainFolder" name="mainFolder">
          <div class="help-text">Nombre de la carpeta principal en Google Drive donde se organizarán las subcarpetas por dominio.</div>
        </div>
        
        <div class="form-group checkbox-group">
          <div class="checkbox-label">
            <input type="checkbox" id="usarNombreUsuario" name="usarNombreUsuario">
            <span>Usar mi nombre de usuario como nombre de carpeta principal</span>
          </div>
          <div class="help-text">Si se activa, se usará tu nombre de usuario de Gmail como nombre de la carpeta principal</div>
        </div>
        
        <div class="form-group checkbox-group">
          <div class="checkbox-label">
            <input type="checkbox" id="usarNombreDominiosGenericos" name="usarNombreDominiosGenericos">
            <span>Usar nombre de usuario para dominios genéricos</span>
          </div>
          <div class="help-text">Para correos de gmail.com, outlook.com, etc., se usará el formato usuario@dominio como nombre de carpeta</div>
        </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Configuración de Sincronización</div>
        <div class="section-content">
        
        <div class="form-group">
          <label for="labelName">Nombre de Etiqueta:</label>
          <input type="text" id="labelName" name="labelName">
          <div class="help-text">Etiqueta que se aplicará a los correos ya procesados.</div>
        </div>
        
        <div class="form-group">
          <label for="maxEmails">Máximo de Correos por Ejecución:</label>
          <input type="number" id="maxEmails" name="maxEmails" min="1" max="500">
          <div class="help-text">Límite de correos a procesar en cada ejecución del script (recomendado: 50-100).</div>
        </div>
        
        <div class="form-group">
          <label for="daysBack">Días Hacia Atrás:</label>
          <input type="number" id="daysBack" name="daysBack" min="0" max="1000">
          <div class="help-text">Límite de días hacia atrás para buscar correos. Use 0 para no establecer límite.</div>
        </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Organización por Patrones de Asunto</div>
        <div class="section-content">
          
          <div class="form-group checkbox-group">
            <div class="checkbox-label">
              <input type="checkbox" id="usarPatronesAsunto" name="usarPatronesAsunto">
              <span>Organizar por patrones en el asunto</span>
            </div>
            <div class="help-text">Si se activa, los correos que contengan ciertos patrones en el asunto se organizarán en carpetas específicas.</div>
          </div>
          
          <div class="form-group">
            <label for="patronesAsunto">Patrones a buscar en el asunto:</label>
            <input type="text" id="patronesAsunto" name="patronesAsunto">
            <div class="help-text">Lista de patrones a buscar separados por comas (ej: ID000, REF-, CV). El script creará carpetas basadas en estos patrones cuando aparezcan en el asunto.</div>
          </div>
          
          <div class="note-box">
            <div class="note-title"><i class="material-icons">info</i> Ejemplo de uso</div>
            <div class="note-content">
              <p>Para un reclutador que busca organizar CVs por referencia:</p>
              <ol>
                <li>Configure el patrón "REF" (sin comillas)</li>
                <li>Los correos con asuntos como "REF001 - CV de Juan Pérez" crearán una carpeta llamada "REF001"</li>
                <li>Todos los adjuntos con ese patrón se guardarán en la misma carpeta</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Filtrado por Dominios</div>
        <div class="section-content">
        
        <div class="form-group">
          <label for="dominiosIncluidos">Dominios a Incluir:</label>
          <input type="text" id="dominiosIncluidos" name="dominiosIncluidos">
          <div class="help-text">Lista de dominios a procesar separados por comas (ej: example.com, *.gmail.com). Dejar en blanco para incluir todos los dominios.</div>
        </div>
        
        <div class="form-group">
          <label for="dominiosExcluidos">Dominios a Excluir:</label>
          <input type="text" id="dominiosExcluidos" name="dominiosExcluidos">
          <div class="help-text">Lista de dominios a ignorar separados por comas (ej: spam.com, newsletter.com). Tiene prioridad sobre los dominios incluidos.</div>
        </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Filtrado por Tipo de Archivo</div>
        <div class="section-content">
        
        <div class="file-types-container">
          <div class="file-types-column">
            <h4>Tipos de archivo recomendados</h4>
            <div class="file-type-grid">
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="pdf">
                <i class="material-icons">picture_as_pdf</i>
                <span>PDF</span>
              </div>
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="doc,docx">
                <i class="material-icons">description</i>
                <span>Word</span>
              </div>
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="xls,xlsx">
                <i class="material-icons">table_chart</i>
                <span>Excel</span>
              </div>
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="ppt,pptx">
                <i class="material-icons">slideshow</i>
                <span>PowerPoint</span>
              </div>
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="txt">
                <i class="material-icons">text_snippet</i>
                <span>Texto</span>
              </div>
              <div class="file-type-item" onclick="toggleFileType(this, true)" data-ext="zip,rar">
                <i class="material-icons">folder_zip</i>
                <span>Comprimidos</span>
              </div>
            </div>
          </div>
          
          <div class="file-types-column">
            <h4>Tipos de archivo a omitir</h4>
            <div class="file-type-grid">
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="exe">
                <i class="material-icons">dangerous</i>
                <span>EXE</span>
              </div>
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="bat,cmd">
                <i class="material-icons">dangerous</i>
                <span>Scripts</span>
              </div>
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="jpg,jpeg,png,gif">
                <i class="material-icons">image</i>
                <span>Imágenes</span>
              </div>
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="mp4,avi,mov">
                <i class="material-icons">videocam</i>
                <span>Vídeos</span>
              </div>
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="mp3,wav">
                <i class="material-icons">audio_file</i>
                <span>Audio</span>
              </div>
              <div class="file-type-item exclude" onclick="toggleFileType(this, false)" data-ext="bin,iso">
                <i class="material-icons">dangerous</i>
                <span>Binarios</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="extensionesPermitidas">Extensiones Permitidas:</label>
          <input type="text" id="extensionesPermitidas" name="extensionesPermitidas">
          <div class="help-text">Lista de extensiones a procesar separadas por comas (ej: pdf, docx, xlsx). Dejar en blanco para incluir todos los tipos de archivo.</div>
        </div>
        
        <div class="form-group">
          <label for="extensionesExcluidas">Extensiones Excluidas:</label>
          <input type="text" id="extensionesExcluidas" name="extensionesExcluidas">
          <div class="help-text">Lista de extensiones a ignorar separadas por comas (ej: exe, bat, bin). Tiene prioridad sobre las extensiones permitidas.</div>
        </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Automatización</div>
        <div class="section-content">
          <div class="form-group checkbox-group">
            <label class="checkbox-container">
              <input type="checkbox" id="automatizacion-activado" name="AUTOMATIZACION.ACTIVADO">
              <span class="checkmark"></span>
              <span>Activar ejecución automática programada</span>
            </label>
            <p class="help-text">Active esta opción para configurar la ejecución automática del script según la frecuencia deseada.</p>
          </div>
          
          <div class="automatizacion-config" id="automatizacion-config" style="display: none;">
            <div class="form-group">
              <label class="freq-label">Frecuencia de ejecución:</label>
              
              <div class="frequency-cards">
                <div class="frequency-card" data-value="horaria">
                  <input type="radio" name="AUTOMATIZACION.FRECUENCIA" id="freq-horaria" value="horaria" class="freq-radio">
                  <label for="freq-horaria" class="freq-card-label">
                    <i class="material-icons freq-icon">schedule</i>
                    <span class="freq-title">Horaria</span>
                    <span class="freq-desc">Ejecutar cada X horas</span>
                  </label>
                </div>
                
                <div class="frequency-card" data-value="diaria">
                  <input type="radio" name="AUTOMATIZACION.FRECUENCIA" id="freq-diaria" value="diaria" class="freq-radio" checked>
                  <label for="freq-diaria" class="freq-card-label">
                    <i class="material-icons freq-icon">today</i>
                    <span class="freq-title">Diaria</span>
                    <span class="freq-desc">Todos los días a una hora fija</span>
                  </label>
                </div>
                
                <div class="frequency-card" data-value="semanal">
                  <input type="radio" name="AUTOMATIZACION.FRECUENCIA" id="freq-semanal" value="semanal" class="freq-radio">
                  <label for="freq-semanal" class="freq-card-label">
                    <i class="material-icons freq-icon">view_week</i>
                    <span class="freq-title">Semanal</span>
                    <span class="freq-desc">Un día concreto cada semana</span>
                  </label>
                </div>
                
                <div class="frequency-card" data-value="mensual">
                  <input type="radio" name="AUTOMATIZACION.FRECUENCIA" id="freq-mensual" value="mensual" class="freq-radio">
                  <label for="freq-mensual" class="freq-card-label">
                    <i class="material-icons freq-icon">calendar_today</i>
                    <span class="freq-title">Mensual</span>
                    <span class="freq-desc">Un día específico cada mes</span>
                  </label>
                </div>
              </div>
              
              <!-- Campo oculto para mantener compatibilidad con el código existente -->
              <select id="frecuencia-automatizacion" name="AUTOMATIZACION.FRECUENCIA" class="form-control" style="display: none;">
                <option value="horaria">Horaria</option>
                <option value="diaria" selected>Diaria</option>
                <option value="semanal">Semanal</option>
                <option value="mensual">Mensual</option>
              </select>
            </div>
            
            <!-- Configuración Horaria -->
            <div class="frecuencia-config" id="config-horaria">
              <div class="form-group">
                <label for="intervalo-horas">Ejecutar cada:</label>
                <div class="input-with-unit">
                  <input type="number" id="intervalo-horas" name="AUTOMATIZACION.INTERVALO_HORAS" class="form-control" min="1" max="24" value="1">
                  <span class="unit">hora(s)</span>
                </div>
              </div>
            </div>
            
            <!-- Configuración Diaria -->
            <div class="frecuencia-config" id="config-diaria">
              <div class="form-group">
                <label for="hora-ejecucion">Hora de ejecución:</label>
                <div class="time-picker">
                  <select id="hora-ejecucion" name="AUTOMATIZACION.HORA_EJECUCION" class="form-control time-select">
                    <option value="0">00</option>
                    <option value="1">01</option>
                    <option value="2">02</option>
                    <option value="3">03</option>
                    <option value="4">04</option>
                    <option value="5">05</option>
                    <option value="6">06</option>
                    <option value="7">07</option>
                    <option value="8" selected>08</option>
                    <option value="9">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                  </select>
                  <span class="time-separator">:</span>
                  <select id="minuto-ejecucion" name="AUTOMATIZACION.MINUTO_EJECUCION" class="form-control time-select">
                    <option value="0" selected>00</option>
                    <option value="5">05</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                    <option value="35">35</option>
                    <option value="40">40</option>
                    <option value="45">45</option>
                    <option value="50">50</option>
                    <option value="55">55</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Configuración Semanal -->
            <div class="frecuencia-config" id="config-semanal">
              <div class="form-group">
                <label for="dia-semana">Día de la semana:</label>
                <select id="dia-semana" name="AUTOMATIZACION.DIA_SEMANA" class="form-control">
                  <option value="1">Lunes</option>
                  <option value="2">Martes</option>
                  <option value="3">Miércoles</option>
                  <option value="4">Jueves</option>
                  <option value="5">Viernes</option>
                  <option value="6">Sábado</option>
                  <option value="7">Domingo</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="hora-ejecucion-semanal">Hora de ejecución:</label>
                <div class="time-picker">
                  <select id="hora-ejecucion-semanal" name="AUTOMATIZACION.HORA_EJECUCION" class="form-control time-select">
                    <option value="0">00</option>
                    <option value="1">01</option>
                    <option value="2">02</option>
                    <option value="3">03</option>
                    <option value="4">04</option>
                    <option value="5">05</option>
                    <option value="6">06</option>
                    <option value="7">07</option>
                    <option value="8" selected>08</option>
                    <option value="9">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                  </select>
                  <span class="time-separator">:</span>
                  <select id="minuto-ejecucion-semanal" name="AUTOMATIZACION.MINUTO_EJECUCION" class="form-control time-select">
                    <option value="0" selected>00</option>
                    <option value="5">05</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                    <option value="35">35</option>
                    <option value="40">40</option>
                    <option value="45">45</option>
                    <option value="50">50</option>
                    <option value="55">55</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Configuración Mensual -->
            <div class="frecuencia-config" id="config-mensual">
              <div class="form-group">
                <label for="dia-mes">Día del mes:</label>
                <select id="dia-mes" name="AUTOMATIZACION.DIA_MES" class="form-control">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="25">25</option>
                  <option value="26">26</option>
                  <option value="27">27</option>
                  <option value="28">28</option>
                  <option value="29">29</option>
                  <option value="30">30</option>
                  <option value="31">31</option>
                </select>
                <p class="help-text">Si selecciona un día que no existe en un mes específico (como 31 de febrero), la ejecución se omitirá ese mes.</p>
              </div>
              
              <div class="form-group">
                <label for="hora-ejecucion-mensual">Hora de ejecución:</label>
                <div class="time-picker">
                  <select id="hora-ejecucion-mensual" name="AUTOMATIZACION.HORA_EJECUCION" class="form-control time-select">
                    <option value="0">00</option>
                    <option value="1">01</option>
                    <option value="2">02</option>
                    <option value="3">03</option>
                    <option value="4">04</option>
                    <option value="5">05</option>
                    <option value="6">06</option>
                    <option value="7">07</option>
                    <option value="8" selected>08</option>
                    <option value="9">09</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                  </select>
                  <span class="time-separator">:</span>
                  <select id="minuto-ejecucion-mensual" name="AUTOMATIZACION.MINUTO_EJECUCION" class="form-control time-select">
                    <option value="0" selected>00</option>
                    <option value="5">05</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>
                    <option value="30">30</option>
                    <option value="35">35</option>
                    <option value="40">40</option>
                    <option value="45">45</option>
                    <option value="50">50</option>
                    <option value="55">55</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div id="automatizacion-info" class="info-box">
              <div class="info-icon"><i class="material-icons">info</i></div>
              <div class="info-content">
                <strong>¿Cómo funciona?</strong> Al guardar esta configuración, se creará automáticamente un disparador (trigger) en Google Apps Script que ejecutará la sincronización según la programación establecida. El script se ejecutará incluso cuando no tengas abierto el navegador.
              </div>
            </div>
            
            <div id="automatizacion-status" class="form-group" style="margin-top: 20px;">
              <button type="button" id="btn-configurar-trigger" class="btn btn-primary">
                <i class="material-icons">schedule</i> Guardar y configurar automatización
              </button>
              <div id="status-trigger" class="status-message"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="section">
        <div class="section-title">Notificaciones</div>
        <div class="section-content">
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="enviarNotificaciones" name="enviarNotificaciones">
            Enviar notificaciones por correo
          </label>
          <div class="help-text">Recibirás un correo con el resumen después de cada sincronización.</div>
        </div>
        
        <div class="form-group" id="detalleNotificacionesGroup">
          <label>Nivel de detalle:</label>
          <div>
            <label class="radio-label">
              <input type="radio" name="detalleNotificaciones" id="detalleBasico" value="basico" checked>
              Básico
            </label>
            <div class="help-text">Solo información esencial (correos procesados, adjuntos guardados, tiempo).</div>
          </div>
          
          <div>
            <label class="radio-label">
              <input type="radio" name="detalleNotificaciones" id="detalleDetallado" value="detallado">
              Detallado
            </label>
            <div class="help-text">Incluye estadísticas por dominio y tipo de archivo.</div>
          </div>
        </div>
      </div>
      
      <div class="actions">
        <div class="button-group">
          <button id="saveBtn" class="btn-primary"><i class="material-icons">save</i>Guardar Configuración</button>
          <button id="testBtn" class="btn-secondary"><i class="material-icons">play_arrow</i>Ejecutar Prueba</button>
        </div>
        <div>
          <button id="resetBtn" class="btn-danger"><i class="material-icons">restart_alt</i>Restablecer Valores</button>
        </div>
      </div>
      
      <!-- Tabs para información adicional -->
      <div class="tabs">
        <div class="tab active" data-tab="info">Información</div>
        <div class="tab" data-tab="ayuda">Ayuda</div>
      </div>
      
      <div class="tab-content active" id="info-content">
        <div class="info-panel">
          <h3>Sobre SPARRING Attach GMAIL v0.4</h3>
          <p>Esta herramienta sincroniza automáticamente los adjuntos de Gmail a Google Drive, organizándolos en carpetas por dominio del remitente.</p>
          
          <h4>Características principales</h4>
          <ul>
            <li><strong>Organización inteligente:</strong> Tus adjuntos se organizan automáticamente por dominio del remitente.</li>
            <li><strong>Filtrado avanzado:</strong> Controla qué dominios y tipos de archivo se procesan.</li>
            <li><strong>Notificaciones:</strong> Recibe resumen detallado de cada sincronización.</li>
            <li><strong>Automatización:</strong> Configura el script para ejecutarse periódicamente.</li>
            <li><strong>Seguridad:</strong> Tus correos originales permanecen intactos, solo se copian los adjuntos.</li>
          </ul>
          
          <h4>Primeros pasos</h4>
          <ol>
            <li>Configura el nombre de la carpeta principal y la etiqueta para correos procesados.</li>
            <li>Establece los filtros de dominio y tipo de archivo según tus necesidades.</li>
            <li>Activa las notificaciones si deseas recibir informes.</li>
            <li>Para sincronización automática, crea un disparador temporal desde el menú "Editar > Activadores actuales del proyecto".</li>
          </ol>
        </div>
      </div>
      
      <div class="section danger-zone">
        <div class="section-title">⚠️ <i class="material-icons danger-icon">warning</i> Danger Zone <i class="material-icons danger-icon">warning</i> ⚠️</div>
        <div class="section-content">
          <p class="warning-text">⚠️ ¡ATENCIÓN! Las acciones en esta sección son irreversibles y eliminan datos sin posibilidad de recuperación automática. ⚠️</p>
          
          <div class="danger-actions" style="flex-direction: column;">
            <div class="danger-action">
              <h4 style="margin-top: 0; margin-bottom: 5px;">🗑️ Eliminar carpeta principal</h4>
              <p style="margin-top: 2px; margin-bottom: 8px; font-size: 0.9em;">⚠️ Esta acción eliminará la carpeta principal y todos los adjuntos en ella.</p>
              <div class="form-group" style="max-width: 600px; margin: 0;">
                <button class="danger-button" id="eliminarCarpetaBtn" onclick="confirmarEliminarCarpeta()" style="width: 100%; padding: 8px;">
                  <i class="material-icons" style="font-size: 18px;">delete_forever</i> Eliminar carpeta principal
                </button>
              </div>
            </div>
            
            <div class="danger-action">
              <h4 style="margin-top: 0; margin-bottom: 5px;">🔄 Restablecer etiquetas procesadas</h4>
              <p style="margin-top: 2px; margin-bottom: 8px; font-size: 0.9em;">⚠️ Esta acción eliminará la etiqueta de "procesado" de todos los correos, permitiendo que sean sincronizados nuevamente.</p>
              <div class="form-group" style="max-width: 600px; margin: 0;">
                <button class="danger-button" id="resetearEtiquetasBtn" onclick="confirmarResetearEtiquetas()" style="width: 100%; padding: 8px;">
                  <i class="material-icons" style="font-size: 18px;">restore</i> Restablecer y reprocesar todos los correos
                </button>
              </div>
            </div>
            
            <div class="danger-action">
              <h4 style="margin-top: 0; margin-bottom: 5px;">📂️ Eliminar carpeta de un dominio específico</h4>
              <p style="margin-top: 2px; margin-bottom: 8px; font-size: 0.9em;">⚠️ Esta acción eliminará solo los adjuntos de un dominio específico.</p>
              <div class="form-group" style="max-width: 600px; margin: 0;">
                <div class="input-group" style="display: flex; align-items: center; gap: 5px;">
                  <input type="text" id="dominioEliminar" placeholder="Ingresa el dominio (ej: google.com)" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #e0e0e0; height: 35px;" />
                  <button class="danger-button" id="eliminarDominioBtn" onclick="confirmarEliminarDominio()" style="height: 35px; padding: 0 12px;">
                    <i class="material-icons" style="font-size: 18px;">delete_sweep</i> Eliminar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="tab-content" id="ayuda-content">
        <h3>Preguntas frecuentes</h3>
        
        <p><strong>¿Cómo funciona el filtrado por dominio?</strong><br>
        Ingresa dominios separados por comas. Puedes usar comodines como *.example.com para incluir/excluir subdominios.<br>
        <em>Ejemplo:</em> "gmail.com, outlook.com" incluirá correos de ambos dominios. "newsletter.*, promociones.*" excluirá todos los dominios que empiecen con esas palabras.</p>
        
        <p><strong>¿Cómo automatizo la sincronización?</strong><br>
        Ve a "Editar > Activadores actuales del proyecto" y configura un disparador para la función "syncAttachments".<br>
        <em>Recomendación:</em> Configura un activador por tiempo cada 1-6 horas dependiendo del volumen de correos que recibas.</p>
        
        <p><strong>¿Por qué no se procesan algunos adjuntos?</strong><br>
        Verifica los filtros de dominio y extensión. También asegúrate de que los archivos no excedan el límite de tamaño de Google Drive (50MB por archivo).</p>
        
        <p><strong>¿El script elimina mis correos originales?</strong><br>
        No, el script solo lee tus correos y copia los adjuntos a Google Drive. Tus correos originales permanecen intactos.</p>
        
        <p><strong>¿Cómo debo interpretar las notificaciones?</strong><br>
        Las notificaciones básicas te informan sobre el número de correos procesados y adjuntos guardados. Las detalladas incluyen estadísticas por dominio y tipo de archivo, útiles para analizar el uso.</p>

        <p><strong>¿Los archivos se sobrescriben si tienen el mismo nombre?</strong><br>
        No, si un archivo con el mismo nombre ya existe, se añade un sufijo numérico para evitar sobrescribirlo.</p>
      </div>
      
      <div id="aviso-legal" class="section" style="margin-top: 20px; margin-bottom: 20px;">
        <div class="section-title"><i class="material-icons" style="vertical-align: middle; font-size: 18px;">gavel</i> Aviso Legal</div>
        <div class="section-content" style="background-color: #f8f9fa; border: 1px solid #ddd; padding: 15px; border-radius: 6px; font-size: 0.9em;">
          <p style="margin-top: 0;"><strong>DESCARGO DE RESPONSABILIDAD:</strong> SPARRING Attach GMAIL es una herramienta interna de SPARRING.dev liberada a la comunidad como recurso gratuito. Al utilizar este script, usted reconoce y acepta que:</p>
          <ol style="margin-bottom: 0; padding-left: 25px;">
            <li>El uso de esta herramienta es bajo su propio riesgo y responsabilidad.</li>
            <li>SPARRING.dev no garantiza la disponibilidad, precisión, fiabilidad o idoneidad de esta herramienta para ningún propósito específico.</li>
            <li>SPARRING.dev no será responsable de ningún daño directo, indirecto, incidental, especial o consecuente que pudiera surgir del uso o la imposibilidad de usar esta herramienta.</li>
            <li>Es su responsabilidad revisar y comprender la funcionalidad del script antes de implementarlo en su entorno.</li>
            <li>SPARRING.dev se reserva el derecho de modificar, actualizar o descontinuar esta herramienta en cualquier momento sin previo aviso.</li>
          </ol>
        </div>
      </div>
      
      <div class="footer">
        <div class="logo"><span>SPARRING</span> Attach GMAIL v0.4</div>
        Desarrollado por <a href="https://sparring.dev" target="_blank">SPARRING.dev</a> - Optimizando procesos. Marzo de 2025<br>
        &copy; 2025 SPARRING.dev - Todos los derechos reservados
      </div>
    </div>
    
    <footer>
      <p>Desarrollado por SPARRING Labs &copy; <?= new Date().getFullYear() ?> | 
        <a href="https://github.com/SparringLabs/attach-gmail-google-script" target="_blank">
          <i class="material-icons" style="font-size: 16px; vertical-align: middle;">code</i> Ver código fuente en GitHub
        </a>
      </p>
    </footer>
    
    <script>
      // Cargar la configuración actual al iniciar
      function loadCurrentConfig() {
        if (typeof google === 'undefined' || !google.script) {
          setTimeout(loadCurrentConfig, 100);
          return;
        }
        
        // Mostrar loader mientras se carga la configuración
        showLoader();
        try {
          google.script.run
            .withSuccessHandler(function(config) {
              // Asegurar que el loader se oculte
              hideLoader();
              updateFormValues(config);
            })
            .withFailureHandler(function(error) {
              // Asegurar que el loader se oculte
              hideLoader();
              showError(error);
            })
            .cargarConfiguracion();
            
          // Agregar timeout de seguridad para ocultar el loader en caso de problemas
          setTimeout(function() {
            hideLoader();
          }, 5000);
        } catch(e) {
          hideLoader();
          showError('Error al cargar la configuración: ' + e.message);
        }
      }
      
      // Actualizar los valores del formulario con la configuración cargada
      function updateFormValues(config) {
        document.getElementById('mainFolder').value = config.MAIN_FOLDER_NAME || '';
        document.getElementById('labelName').value = config.PROCESSED_LABEL_NAME || '';
        document.getElementById('usarNombreUsuario').checked = config.USAR_NOMBRE_USUARIO || false;
        document.getElementById('usarNombreDominiosGenericos').checked = config.USAR_NOMBRE_PARA_DOMINIOS_GENERICOS || false;
        document.getElementById('maxEmails').value = config.MAX_EMAILS_TO_PROCESS || 50;
        document.getElementById('daysBack').value = config.DAYS_TO_LOOK_BACK || 0;
        
        // Configurar opciones de patrones de asunto
        document.getElementById('usarPatronesAsunto').checked = config.USAR_PATRONES_ASUNTO || false;
        
        // Convertir arrays a texto separado por comas para los patrones de asunto
        if (config.PATRONES_ASUNTO && Array.isArray(config.PATRONES_ASUNTO)) {
          document.getElementById('patronesAsunto').value = config.PATRONES_ASUNTO.join(', ');
        }
        
        // Convertir arrays a texto separado por comas para los campos de dominios
        if (config.DOMINIOS_INCLUIDOS && Array.isArray(config.DOMINIOS_INCLUIDOS)) {
          document.getElementById('dominiosIncluidos').value = config.DOMINIOS_INCLUIDOS.join(', ');
        }
        
        if (config.DOMINIOS_EXCLUIDOS && Array.isArray(config.DOMINIOS_EXCLUIDOS)) {
          document.getElementById('dominiosExcluidos').value = config.DOMINIOS_EXCLUIDOS.join(', ');
        }
        
        // Convertir arrays a texto separado por comas para los campos de extensiones
        if (config.EXTENSIONES_PERMITIDAS && Array.isArray(config.EXTENSIONES_PERMITIDAS)) {
          document.getElementById('extensionesPermitidas').value = config.EXTENSIONES_PERMITIDAS.join(', ');
        }
        
        if (config.EXTENSIONES_EXCLUIDAS && Array.isArray(config.EXTENSIONES_EXCLUIDAS)) {
          document.getElementById('extensionesExcluidas').value = config.EXTENSIONES_EXCLUIDAS.join(', ');
        }
        
        // Configurar opciones de notificaciones
        document.getElementById('enviarNotificaciones').checked = config.ENVIAR_NOTIFICACIONES !== false;
        
        // Seleccionar el nivel de detalle adecuado
        const detalleNotificaciones = config.DETALLE_NOTIFICACIONES || 'basico';
        document.getElementById(detalleNotificaciones === 'detallado' ? 'detalleDetallado' : 'detalleBasico').checked = true;
        
        // Mostrar/ocultar opciones de detalle según si las notificaciones están activadas
        toggleDetalleNotificaciones();
        
        // Ocultar el spinner una vez que los datos están cargados
        hideLoader();
      }
      
      // Guardar la configuración
      function saveConfig() {
        // Procesar los campos de dominios para convertirlos de texto a arrays
        const dominiosIncluidosText = document.getElementById('dominiosIncluidos').value;
        const dominiosExcluidosText = document.getElementById('dominiosExcluidos').value;
        
        // Convertir texto separado por comas a arrays, eliminando espacios en blanco
        const dominiosIncluidos = dominiosIncluidosText ? 
          dominiosIncluidosText.split(',').map(domain => domain.trim()).filter(domain => domain.length > 0) : [];
        
        const dominiosExcluidos = dominiosExcluidosText ? 
          dominiosExcluidosText.split(',').map(domain => domain.trim()).filter(domain => domain.length > 0) : [];
        
        // Procesar los campos de extensiones para convertirlos de texto a arrays
        const extensionesPermitidasText = document.getElementById('extensionesPermitidas').value;
        const extensionesExcluidasText = document.getElementById('extensionesExcluidas').value;
        
        // Convertir texto separado por comas a arrays, eliminando espacios en blanco
        const extensionesPermitidas = extensionesPermitidasText ? 
          extensionesPermitidasText.split(',').map(ext => ext.trim()).filter(ext => ext.length > 0) : [];
        
        const extensionesExcluidas = extensionesExcluidasText ? 
          extensionesExcluidasText.split(',').map(ext => ext.trim()).filter(ext => ext.length > 0) : [];
        
        // Procesar los campos de patrones de asunto para convertirlos de texto a arrays
        const patronesAsuntoText = document.getElementById('patronesAsunto').value;
        const patronesAsunto = patronesAsuntoText ? 
          patronesAsuntoText.split(',').map(pattern => pattern.trim()).filter(pattern => pattern.length > 0) : [];
          
        const newConfig = {
          MAIN_FOLDER_NAME: document.getElementById('mainFolder').value,
          PROCESSED_LABEL_NAME: document.getElementById('labelName').value,
          USAR_NOMBRE_USUARIO: document.getElementById('usarNombreUsuario').checked,
          USAR_NOMBRE_PARA_DOMINIOS_GENERICOS: document.getElementById('usarNombreDominiosGenericos').checked,
          USAR_PATRONES_ASUNTO: document.getElementById('usarPatronesAsunto').checked,
          PATRONES_ASUNTO: patronesAsunto,
          MAX_EMAILS_TO_PROCESS: parseInt(document.getElementById('maxEmails').value, 10),
          DAYS_TO_LOOK_BACK: parseInt(document.getElementById('daysBack').value, 10),
          DOMINIOS_INCLUIDOS: dominiosIncluidos,
          DOMINIOS_EXCLUIDOS: dominiosExcluidos,
          EXTENSIONES_PERMITIDAS: extensionesPermitidas,
          EXTENSIONES_EXCLUIDAS: extensionesExcluidas,
          ENVIAR_NOTIFICACIONES: document.getElementById('enviarNotificaciones').checked,
          DETALLE_NOTIFICACIONES: document.querySelector('input[name="detalleNotificaciones"]:checked').value
        };
        
        google.script.run
          .withSuccessHandler(configSaved)
          .withFailureHandler(showError)
          .cambiarConfiguracion(newConfig);
      }
      
      // Ejecutar una prueba de sincronización
      function runTest() {
        showStatus("Ejecutando prueba de sincronización...", false);
        
        google.script.run
          .withSuccessHandler(function(result) {
            hideLoader();
            const mensaje = result && result.mensaje ? result.mensaje : "Prueba completada correctamente. Revise los registros para ver detalles.";
            showStatus(mensaje, true);
          })
          .withFailureHandler(showError)
          .testSync();
      }
      
      // Restablecer a valores predeterminados (usará el nuevo manejador con eventos en DOMContentLoaded)
      function resetConfig() {
        // Esta función se reemplaza por el manejador de eventos en DOMContentLoaded
        // pero mantenemos la declaración para compatibilidad
      }
      
      // Mostrar mensaje de éxito al guardar
      function configSaved(config) {
        updateFormValues(config);
        showStatus("Configuración guardada correctamente.", true);
        hideLoader();
      }
      
      // Mostrar mensaje de estado
      function showStatus(message, isSuccess) {
        const statusElem = document.getElementById('status');
        statusElem.textContent = message;
        statusElem.className = isSuccess ? "status success" : "status";
      }
      
      // Función para mostrar/ocultar opciones de detalle de notificaciones
      function toggleDetalleNotificaciones() {
        const notificacionesActivadas = document.getElementById('enviarNotificaciones').checked;
        document.getElementById('detalleNotificacionesGroup').style.display = notificacionesActivadas ? 'block' : 'none';
      }
      
      // Mostrar mensaje de error
      function showError(error) {
        const statusElem = document.getElementById('status');
        statusElem.textContent = "Error: " + (error || "Ocurrió un error desconocido");
        statusElem.className = "status error";
        // Asegurar que el loader se oculte incluso en caso de error
        hideLoader();
      }
      
      // Mostrar loader/spinner
      function showLoader() {
        document.getElementById('loader').style.display = 'flex';
      }
      
      // Ocultar loader/spinner
      function hideLoader() {
        document.getElementById('loader').style.display = 'none';
      }
      
      // Función para colapsar/expandir secciones
      function toggleSection(element) {
        const section = element.closest('.section');
        section.classList.toggle('collapsed');
      }
      
      // Función para cambiar entre tabs
      function switchTab(tabId) {
        // Desactivar todas las tabs y contenidos
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Activar la tab seleccionada y su contenido
        document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        document.getElementById(`${tabId}-content`).classList.add('active');
      }
      
      // Asegurar que la API de Google está disponible antes de llamarla
      function checkGoogleScriptApiReady() {
        if (typeof google !== 'undefined' && google.script) {
          // Ocultar el preloader si está visible por alguna razón
          hideLoader();
          // Cargar la configuración
          loadCurrentConfig();
        } else {
          // Intentar de nuevo en 100ms
          setTimeout(checkGoogleScriptApiReady, 100);
        }
      }
      
      // Inicializar cuando el documento esté completamente cargado
      window.onload = function() {
        // Asegurarse de que el preloader esté oculto inicialmente
        hideLoader();
        // Verificar si la API de Google está lista
        setTimeout(checkGoogleScriptApiReady, 100);
      };
      
      // Función para seleccionar/deseleccionar tipos de archivo
      window.toggleFileType = function(element, isInclude) {
        element.classList.toggle('selected');
        
        // Actualizar los campos de texto
        const extensions = element.getAttribute('data-ext').split(',');
        const inputId = isInclude ? 'extensionesPermitidas' : 'extensionesExcluidas';
        const input = document.getElementById(inputId);
        let currentExts = input.value.split(',').map(e => e.trim()).filter(e => e);
        
        if (element.classList.contains('selected')) {
          // Añadir extensiones
          currentExts = [...new Set([...currentExts, ...extensions])];  // Eliminar duplicados usando Set
        } else {
          // Quitar extensiones
          currentExts = currentExts.filter(ext => !extensions.includes(ext));
        }
        
        input.value = currentExts.join(', ');
      }
      
      // Función para confirmar eliminación de carpeta principal
      window.confirmarEliminarCarpeta = function() {
        const confirmacion = confirm('¿Estás seguro de que deseas eliminar la carpeta principal y todos sus contenidos? Esta acción moverá la carpeta a la papelera de Google Drive.');
        if (confirmacion) {
          showLoader();
          google.script.run
            .withSuccessHandler(function(result) {
              hideLoader();
              if (result.exito) {
                showStatus(result.mensaje, true);
              } else {
                showStatus(result.mensaje, false);
              }
            })
            .withFailureHandler(function(error) {
              hideLoader();
              showError(error);
            })
            .eliminarCarpetaPrincipal();
        }
      }
      
      // Función para confirmar eliminación de dominio
      window.confirmarEliminarDominio = function() {
        const dominio = document.getElementById('dominioEliminar').value.trim();
        if (!dominio) {
          showStatus('Debes especificar un dominio válido', false);
          return;
        }
        
        const confirmacion = confirm(`¿Estás seguro de que deseas eliminar la carpeta del dominio "${dominio}" y todos sus contenidos? Esta acción moverá la carpeta a la papelera de Google Drive.`);
        if (confirmacion) {
          showLoader();
          google.script.run
            .withSuccessHandler(function(result) {
              hideLoader();
              if (result.exito) {
                showStatus(result.mensaje, true);
                document.getElementById('dominioEliminar').value = '';
              } else {
                showStatus(result.mensaje, false);
              }
            })
            .withFailureHandler(function(error) {
              hideLoader();
              showError(error);
            })
            .eliminarCarpetaDominio(dominio);
        }
      }
      
      // Función para confirmar reseteo de etiquetas procesadas
      window.confirmarResetearEtiquetas = function() {
        const confirmacion = confirm(`⚠️ ADVERTENCIA: Esta acción eliminará las etiquetas de procesado de todos los correos.\n\nEsto permitirá que todos los correos sean procesados nuevamente en la próxima sincronización.\n\n¿Estás COMPLETAMENTE seguro de querer continuar?`);
        if (confirmacion) {
          showLoader();
          google.script.run
            .withSuccessHandler(function(result) {
              hideLoader();
              if (result && result.exito) {
                showStatus(result.mensaje, true);
              } else {
                showStatus(result?.mensaje || 'Las etiquetas han sido restablecidas.', true);
              }
            })
            .withFailureHandler(function(error) {
              hideLoader();
              showError('Error al restablecer etiquetas: ' + error);
            })
            .resetearEtiquetasProcesados();
        }
      }
      
      // Función para mostrar/ocultar la sección de automatización
      function toggleAutomatizacion() {
        const activado = document.getElementById('automatizacion-activado').checked;
        const configDiv = document.getElementById('automatizacion-config');
        configDiv.style.display = activado ? 'block' : 'none';
      }
      
      // Función para mostrar/ocultar las opciones según la frecuencia seleccionada
      function toggleFrecuenciaConfig() {
        // Obtener frecuencia del elemento oculto
        const frecuencia = document.getElementById('frecuencia-automatizacion').value;
        const configHoraria = document.getElementById('config-horaria');
        const configDiaria = document.getElementById('config-diaria');
        const configSemanal = document.getElementById('config-semanal');
        const configMensual = document.getElementById('config-mensual');
        
        // Ocultar todas las configuraciones
        configHoraria.style.display = 'none';
        configDiaria.style.display = 'none';
        configSemanal.style.display = 'none';
        configMensual.style.display = 'none';
        
        // Mostrar la configuración correspondiente a la frecuencia seleccionada
        switch (frecuencia) {
          case 'horaria':
            configHoraria.style.display = 'block';
            break;
          case 'diaria':
            configDiaria.style.display = 'block';
            break;
          case 'semanal':
            configSemanal.style.display = 'block';
            break;
          case 'mensual':
            configMensual.style.display = 'block';
            break;
          case 'personalizada':
            configHoraria.style.display = 'block';
            break;
        }
        
        // Actualizar visualemente qué tarjeta está seleccionada
        document.querySelectorAll('.frequency-card').forEach(card => {
          const cardValue = card.getAttribute('data-value');
          const radioInput = document.getElementById('freq-' + cardValue);
          if (cardValue === frecuencia) {
            radioInput.checked = true;
          }
        });
      }
      
      // Manejar clicks en las tarjetas de frecuencia
      function handleFrequencyCardSelection(event) {
        const selectedValue = event.currentTarget.getAttribute('data-value');
        // Actualizar el select oculto para mantener compatibilidad
        const selectElement = document.getElementById('frecuencia-automatizacion');
        selectElement.value = selectedValue;
        
        // Mostrar la configuración correspondiente
        toggleFrecuenciaConfig();
      }
      
      // Función para configurar el disparador según las opciones seleccionadas
      function configurarTrigger() {
        showLoader();
        const statusTrigger = document.getElementById('status-trigger');
        statusTrigger.textContent = "Configurando disparador...";
        statusTrigger.style.display = "block";
        statusTrigger.className = "status-message";
        
        // Recopilar configuración de automatización
        const config = {
          ACTIVADO: document.getElementById('automatizacion-activado').checked,
          FRECUENCIA: document.getElementById('frecuencia-automatizacion').value
        };
        
        // Configuración específica según la frecuencia
        switch (config.FRECUENCIA) {
          case 'horaria':
            config.INTERVALO_HORAS = parseInt(document.getElementById('intervalo-horas').value, 10) || 1;
            break;
          case 'diaria':
            config.HORA_EJECUCION = parseInt(document.getElementById('hora-ejecucion').value, 10) || 8;
            config.MINUTO_EJECUCION = parseInt(document.getElementById('minuto-ejecucion').value, 10) || 0;
            break;
          case 'semanal':
            config.DIA_SEMANA = parseInt(document.getElementById('dia-semana').value, 10) || 1;
            config.HORA_EJECUCION = parseInt(document.getElementById('hora-ejecucion-semanal').value, 10) || 8;
            config.MINUTO_EJECUCION = parseInt(document.getElementById('minuto-ejecucion-semanal').value, 10) || 0;
            break;
          case 'mensual':
            config.DIA_MES = parseInt(document.getElementById('dia-mes').value, 10) || 1;
            config.HORA_EJECUCION = parseInt(document.getElementById('hora-ejecucion-mensual').value, 10) || 8;
            config.MINUTO_EJECUCION = parseInt(document.getElementById('minuto-ejecucion-mensual').value, 10) || 0;
            break;
        }
        
        // Llamar a la función del servidor para configurar el disparador
        google.script.run
          .withSuccessHandler(function(result) {
            hideLoader();
            if (result.exito) {
              statusTrigger.textContent = result.mensaje;
              statusTrigger.className = "status-message success";
            } else {
              statusTrigger.textContent = result.mensaje;
              statusTrigger.className = "status-message error";
            }
          })
          .withFailureHandler(function(error) {
            hideLoader();
            statusTrigger.textContent = "Error: " + error.message;
            statusTrigger.className = "status-message error";
          })
          .configureTrigger(config);
      }
      
      // Configurar eventos cuando se carga la estructura DOM
      document.addEventListener('DOMContentLoaded', function() {
        // Cargar la configuración al cargar la página
        loadCurrentConfig();
        
        // Cargar extensiones actuales en la interfaz visual
        setTimeout(function() {
          actualizarInterfazTiposArchivo();
        }, 1000);
        
        // Eventos de botones principales con loader
        document.getElementById('saveBtn').addEventListener('click', function() {
          showLoader();
          saveConfig();
        });
        
        document.getElementById('testBtn').addEventListener('click', function() {
          showLoader();
          runTest();
        });
        
        document.getElementById('resetBtn').addEventListener('click', function() {
          if (confirm("¿Está seguro que desea restablecer todos los valores a la configuración predeterminada?")) {
            showLoader();
            google.script.run
              .withSuccessHandler(function(config) {
                updateFormValues(config);
                showStatus("Configuración restablecida a valores predeterminados.", true);
                hideLoader();
              })
              .withFailureHandler(showError)
              .restablecerConfiguracion();
          }
        });
        
        // Configurar evento para mostrar/ocultar opciones de notificaciones
        document.getElementById('enviarNotificaciones').addEventListener('change', toggleDetalleNotificaciones);
        
        // Eventos para sección de automatización
        document.getElementById('automatizacion-activado').addEventListener('change', toggleAutomatizacion);
        
        // Manejar el select oculto de frecuencia (para compatibilidad)
        document.getElementById('frecuencia-automatizacion').addEventListener('change', toggleFrecuenciaConfig);
        
        // Manejar clicks en las tarjetas de frecuencia
        document.querySelectorAll('.frequency-card').forEach(card => {
          card.addEventListener('click', function() {
            const selectedValue = this.getAttribute('data-value');
            const radioInput = document.getElementById('freq-' + selectedValue);
            radioInput.checked = true;
            
            // Actualizar el select oculto
            document.getElementById('frecuencia-automatizacion').value = selectedValue;
            
            // Actualizar la visualización
            toggleFrecuenciaConfig();
          });
        });
        
        // Manejar cambios en los radios de frecuencia
        document.querySelectorAll('.freq-radio').forEach(radio => {
          radio.addEventListener('change', function() {
            if (this.checked) {
              document.getElementById('frecuencia-automatizacion').value = this.value;
              toggleFrecuenciaConfig();
            }
          });
        });
        
        document.getElementById('btn-configurar-trigger').addEventListener('click', configurarTrigger);
        
        // Eventos para secciones colapsables
        document.querySelectorAll('.section-title').forEach(title => {
          title.addEventListener('click', function() {
            toggleSection(this);
          });
        });
        
        // Eventos para tabs
        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', function() {
            switchTab(this.getAttribute('data-tab'));
          });
        });
        
        // Inicializar estados de interfaz
        toggleDetalleNotificaciones();
        toggleAutomatizacion();
        toggleFrecuenciaConfig();
      });
    </script>
  </body>
</html>
